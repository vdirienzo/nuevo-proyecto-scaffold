/**
 * Global setup for Tauri E2E tests
 *
 * Author: {{AUTHOR}}
 */

import { FullConfig } from '@playwright/test';
import { exec } from 'child_process';
import { promisify } from 'util';

const execAsync = promisify(exec);

/**
 * Global setup runs before all tests
 * Use this to prepare the test environment
 */
async function globalSetup(config: FullConfig): Promise<void> {
  console.log('üöÄ Starting global setup for Tauri E2E tests...');

  try {
    // Check if Tauri CLI is available
    await execAsync('cargo tauri --version');
    console.log('‚úÖ Tauri CLI found');
  } catch (error) {
    console.error('‚ùå Tauri CLI not found. Please install it first.');
    throw error;
  }

  // Build the app if in CI mode
  if (process.env.CI) {
    console.log('üì¶ Building Tauri app for CI...');
    try {
      await execAsync('npm run tauri build', {
        timeout: 300_000, // 5 minutes
      });
      console.log('‚úÖ Tauri app built successfully');
    } catch (error) {
      console.error('‚ùå Failed to build Tauri app:', error);
      throw error;
    }
  }

  console.log('‚úÖ Global setup completed');
}

export default globalSetup;
