<script setup lang="ts">
/**
 * TitleBar.vue - Custom window title bar component
 *
 * Autor: {{AUTHOR}}
 */

import { ref, onMounted, onUnmounted } from 'vue';
import { getCurrentWindow } from '@tauri-apps/api/window';

interface Props {
  title?: string;
  icon?: string;
}

const props = withDefaults(defineProps<Props>(), {
  title: '{{APP_TITLE}}',
});

const isMaximized = ref(false);
const appWindow = getCurrentWindow();
let unlistenResize: (() => void) | null = null;

onMounted(async () => {
  // Check initial maximized state
  isMaximized.value = await appWindow.isMaximized();

  // Listen for window resize events
  unlistenResize = await appWindow.onResized(async () => {
    isMaximized.value = await appWindow.isMaximized();
  });
});

onUnmounted(() => {
  if (unlistenResize) {
    unlistenResize();
  }
});

async function handleMinimize() {
  await appWindow.minimize();
}

async function handleMaximize() {
  await appWindow.toggleMaximize();
}

async function handleClose() {
  await appWindow.close();
}
</script>

<template>
  <div
    data-tauri-drag-region
    class="flex items-center justify-between h-10 bg-gray-100 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 select-none"
  >
    <!-- Left side - Icon and Title -->
    <div
      data-tauri-drag-region
      class="flex items-center gap-2 px-3 flex-1"
    >
      <img
        v-if="icon"
        :src="icon"
        alt="App icon"
        class="w-5 h-5"
        draggable="false"
      />
      <span
        data-tauri-drag-region
        class="text-sm font-medium text-gray-700 dark:text-gray-300"
      >
        {{ title }}
      </span>
    </div>

    <!-- Right side - Window controls -->
    <div class="flex items-center h-full">
      <!-- Minimize button -->
      <button
        @click="handleMinimize"
        class="h-full px-4 hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors focus:outline-none focus:ring-2 focus:ring-inset focus:ring-gray-400"
        aria-label="Minimize window"
        title="Minimize"
      >
        <svg
          class="w-4 h-4 text-gray-600 dark:text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M20 12H4"
          />
        </svg>
      </button>

      <!-- Maximize/Restore button -->
      <button
        @click="handleMaximize"
        class="h-full px-4 hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors focus:outline-none focus:ring-2 focus:ring-inset focus:ring-gray-400"
        :aria-label="isMaximized ? 'Restore window' : 'Maximize window'"
        :title="isMaximized ? 'Restore' : 'Maximize'"
      >
        <!-- Restore icon -->
        <svg
          v-if="isMaximized"
          class="w-4 h-4 text-gray-600 dark:text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"
          />
        </svg>
        <!-- Maximize icon -->
        <svg
          v-else
          class="w-4 h-4 text-gray-600 dark:text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"
          />
        </svg>
      </button>

      <!-- Close button -->
      <button
        @click="handleClose"
        class="h-full px-4 hover:bg-red-500 hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-400"
        aria-label="Close window"
        title="Close"
      >
        <svg
          class="w-4 h-4 text-gray-600 dark:text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>
  </div>
</template>
