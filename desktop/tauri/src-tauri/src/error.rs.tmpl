/*!
 * Application Error Types
 *
 * Author: {{AUTHOR}}
 */

use serde::Serialize;
use thiserror::Error;

/// Application error type
#[derive(Debug, Error)]
pub enum AppError {
    #[error("Database error: {0}")]
    Database(#[from] sqlx::Error),

    #[error("IO error: {0}")]
    Io(#[from] std::io::Error),

    #[error("Serialization error: {0}")]
    Serialization(#[from] serde_json::Error),

    #[error("Authentication error: {0}")]
    Authentication(String),

    #[error("Authorization error: {0}")]
    Authorization(String),

    #[error("Validation error: {0}")]
    Validation(String),

    #[error("Not found: {0}")]
    NotFound(String),

    #[error("Configuration error: {0}")]
    Config(String),

    #[error("Internal error: {0}")]
    Internal(String),
}

/// Serializable error response for frontend
#[derive(Debug, Serialize)]
pub struct ErrorResponse {
    pub code: String,
    pub message: String,
}

impl From<AppError> for ErrorResponse {
    fn from(error: AppError) -> Self {
        let (code, message) = match &error {
            AppError::Database(_) => ("DATABASE_ERROR", error.to_string()),
            AppError::Io(_) => ("IO_ERROR", error.to_string()),
            AppError::Serialization(_) => ("SERIALIZATION_ERROR", error.to_string()),
            AppError::Authentication(msg) => ("AUTH_ERROR", msg.clone()),
            AppError::Authorization(msg) => ("AUTHORIZATION_ERROR", msg.clone()),
            AppError::Validation(msg) => ("VALIDATION_ERROR", msg.clone()),
            AppError::NotFound(msg) => ("NOT_FOUND", msg.clone()),
            AppError::Config(msg) => ("CONFIG_ERROR", msg.clone()),
            AppError::Internal(msg) => ("INTERNAL_ERROR", msg.clone()),
        };

        Self {
            code: code.to_string(),
            message,
        }
    }
}

// Implement conversion to Tauri's invoke error
impl From<AppError> for tauri::ipc::InvokeError {
    fn from(error: AppError) -> Self {
        let response = ErrorResponse::from(error);
        tauri::ipc::InvokeError::from(serde_json::to_string(&response).unwrap_or_default())
    }
}

/// Result type alias for application
pub type AppResult<T> = Result<T, AppError>;
