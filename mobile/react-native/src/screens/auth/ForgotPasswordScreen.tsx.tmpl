/**
 * Forgot Password Screen
 *
 * Author: {{AUTHOR}}
 */

import React, {useState} from 'react';
import {View, StyleSheet} from 'react-native';
import {Text, useTheme} from 'react-native-paper';
import {useNavigation} from '@react-navigation/native';

import Container from '@components/layout/Container';
import Input from '@components/ui/Input';
import Button from '@components/ui/Button';
import {AuthNavigationProp} from '@navigation/types';

const ForgotPasswordScreen = (): JSX.Element => {
  const theme = useTheme();
  const navigation = useNavigation<AuthNavigationProp>();

  const [email, setEmail] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [emailSent, setEmailSent] = useState(false);

  const validate = (): boolean => {
    if (!email) {
      setError('Email is required');
      return false;
    }
    if (!/\S+@\S+\.\S+/.test(email)) {
      setError('Email is invalid');
      return false;
    }
    setError('');
    return true;
  };

  const handleResetPassword = async () => {
    if (!validate()) return;

    setIsLoading(true);
    try {
      // TODO: Implement forgot password API call
      await new Promise(resolve => setTimeout(resolve, 1500));
      setEmailSent(true);
    } catch (err) {
      console.error('Reset password error:', err);
      setError('Failed to send reset email. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };

  if (emailSent) {
    return (
      <Container>
        <View style={styles.content}>
          <Text variant="headlineMedium" style={[styles.title, {color: theme.colors.primary}]}>
            Check Your Email
          </Text>
          <Text variant="bodyMedium" style={[styles.message, {color: theme.colors.onSurfaceVariant}]}>
            We've sent password reset instructions to {email}
          </Text>
          <Button
            mode="contained"
            onPress={() => navigation.navigate('Login')}
            style={styles.button}>
            Back to Login
          </Button>
        </View>
      </Container>
    );
  }

  return (
    <Container>
      <View style={styles.content}>
        <Text variant="headlineLarge" style={[styles.title, {color: theme.colors.primary}]}>
          Reset Password
        </Text>
        <Text variant="bodyMedium" style={[styles.subtitle, {color: theme.colors.onSurfaceVariant}]}>
          Enter your email address and we'll send you instructions to reset your password
        </Text>

        <Input
          label="Email"
          value={email}
          onChangeText={setEmail}
          error={error}
          keyboardType="email-address"
          autoCapitalize="none"
          autoComplete="email"
        />

        <Button
          mode="contained"
          onPress={handleResetPassword}
          loading={isLoading}
          disabled={isLoading}
          style={styles.button}>
          Send Reset Link
        </Button>

        <Button
          mode="text"
          onPress={() => navigation.navigate('Login')}>
          Back to Login
        </Button>
      </View>
    </Container>
  );
};

const styles = StyleSheet.create({
  content: {
    flex: 1,
    justifyContent: 'center',
    paddingHorizontal: 24,
  },
  title: {
    textAlign: 'center',
    marginBottom: 8,
  },
  subtitle: {
    textAlign: 'center',
    marginBottom: 32,
  },
  message: {
    textAlign: 'center',
    marginBottom: 32,
    lineHeight: 24,
  },
  button: {
    marginTop: 24,
    marginBottom: 16,
  },
});

export default ForgotPasswordScreen;
