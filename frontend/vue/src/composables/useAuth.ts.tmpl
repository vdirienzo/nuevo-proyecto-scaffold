/**
 * useAuth.ts - Auth composable
 * @author {{AUTHOR}}
 * @project {{PROJECT_NAME}}
 */

import { computed } from 'vue'
import { useRouter } from 'vue-router'
import { useAuthStore } from '@/stores/auth'
import type { LoginCredentials, RegisterData } from '@/types'
import { useNotification } from './useNotification'

export function useAuth() {
  const authStore = useAuthStore()
  const router = useRouter()
  const { showSuccess, showError } = useNotification()

  const isAuthenticated = computed(() => authStore.isAuthenticated)
  const user = computed(() => authStore.user)
  const isLoading = computed(() => authStore.loading)

  const login = async (credentials: LoginCredentials) => {
    try {
      await authStore.login(credentials)
      showSuccess('Login successful')
      router.push({ name: 'dashboard' })
    } catch (error) {
      showError(error instanceof Error ? error.message : 'Login failed')
      throw error
    }
  }

  const register = async (data: RegisterData) => {
    try {
      await authStore.register(data)
      showSuccess('Registration successful')
      router.push({ name: 'dashboard' })
    } catch (error) {
      showError(error instanceof Error ? error.message : 'Registration failed')
      throw error
    }
  }

  const logout = async () => {
    try {
      await authStore.logout()
      showSuccess('Logged out successfully')
      router.push({ name: 'home' })
    } catch (error) {
      showError(error instanceof Error ? error.message : 'Logout failed')
    }
  }

  const refreshToken = async () => {
    try {
      await authStore.refreshToken()
    } catch (error) {
      console.error('Token refresh failed:', error)
      await logout()
    }
  }

  return {
    isAuthenticated,
    user,
    isLoading,
    login,
    register,
    logout,
    refreshToken
  }
}
