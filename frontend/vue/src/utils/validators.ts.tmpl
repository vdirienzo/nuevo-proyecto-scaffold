/**
 * utils/validators.ts - Form validation functions
 * @author {{AUTHOR}}
 * @project {{PROJECT_NAME}}
 */

import type { ValidationRule } from '@/composables/useForm'

/**
 * Required field validator
 */
export function required(message = 'This field is required'): ValidationRule {
  return (value: any) => {
    if (value === null || value === undefined || value === '') {
      return message
    }
    if (typeof value === 'string' && value.trim() === '') {
      return message
    }
    return undefined
  }
}

/**
 * Email validator
 */
export function email(message = 'Invalid email address'): ValidationRule {
  return (value: string) => {
    if (!value) return undefined

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    if (!emailRegex.test(value)) {
      return message
    }
    return undefined
  }
}

/**
 * Minimum length validator
 */
export function minLength(min: number, message?: string): ValidationRule {
  return (value: string) => {
    if (!value) return undefined

    if (value.length < min) {
      return message || `Must be at least ${min} characters`
    }
    return undefined
  }
}

/**
 * Maximum length validator
 */
export function maxLength(max: number, message?: string): ValidationRule {
  return (value: string) => {
    if (!value) return undefined

    if (value.length > max) {
      return message || `Must be no more than ${max} characters`
    }
    return undefined
  }
}

/**
 * Pattern validator
 */
export function pattern(regex: RegExp, message = 'Invalid format'): ValidationRule {
  return (value: string) => {
    if (!value) return undefined

    if (!regex.test(value)) {
      return message
    }
    return undefined
  }
}

/**
 * Number validator
 */
export function isNumber(message = 'Must be a number'): ValidationRule {
  return (value: any) => {
    if (!value) return undefined

    if (isNaN(Number(value))) {
      return message
    }
    return undefined
  }
}

/**
 * Minimum value validator
 */
export function min(minValue: number, message?: string): ValidationRule {
  return (value: number) => {
    if (value === null || value === undefined) return undefined

    if (Number(value) < minValue) {
      return message || `Must be at least ${minValue}`
    }
    return undefined
  }
}

/**
 * Maximum value validator
 */
export function max(maxValue: number, message?: string): ValidationRule {
  return (value: number) => {
    if (value === null || value === undefined) return undefined

    if (Number(value) > maxValue) {
      return message || `Must be no more than ${maxValue}`
    }
    return undefined
  }
}

/**
 * Match field validator (for password confirmation)
 */
export function matchField(fieldName: string, message?: string): ValidationRule {
  return (value: any, formData?: Record<string, any>) => {
    if (!value || !formData) return undefined

    if (value !== formData[fieldName]) {
      return message || `Must match ${fieldName}`
    }
    return undefined
  }
}

/**
 * URL validator
 */
export function url(message = 'Invalid URL'): ValidationRule {
  return (value: string) => {
    if (!value) return undefined

    try {
      new URL(value)
      return undefined
    } catch {
      return message
    }
  }
}

/**
 * Phone validator (basic)
 */
export function phone(message = 'Invalid phone number'): ValidationRule {
  return (value: string) => {
    if (!value) return undefined

    const phoneRegex = /^[\d\s\-\+\(\)]+$/
    if (!phoneRegex.test(value) || value.replace(/\D/g, '').length < 10) {
      return message
    }
    return undefined
  }
}

/**
 * Alphanumeric validator
 */
export function alphanumeric(message = 'Must contain only letters and numbers'): ValidationRule {
  return (value: string) => {
    if (!value) return undefined

    const alphanumericRegex = /^[a-zA-Z0-9]+$/
    if (!alphanumericRegex.test(value)) {
      return message
    }
    return undefined
  }
}

/**
 * Custom validator
 */
export function custom(
  validator: (value: any) => boolean,
  message = 'Invalid value'
): ValidationRule {
  return (value: any) => {
    if (!value) return undefined

    if (!validator(value)) {
      return message
    }
    return undefined
  }
}
