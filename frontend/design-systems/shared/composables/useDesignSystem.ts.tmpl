/**
 * useDesignSystem.ts - Vue composable for design system configuration
 *
 * Autor: {{AUTHOR}}
 * Project: {{PROJECT_NAME}}
 */

import { inject, computed, InjectionKey, ComputedRef } from 'vue';
import type { DesignSystemConfig, DesignTokens, ComponentStyles } from '../types';

export interface DesignSystemContext {
  config: ComputedRef<DesignSystemConfig>;
  tokens: ComputedRef<DesignTokens>;
  components: ComputedRef<ComponentStyles>;
  setSystem: (systemName: string) => Promise<void>;
}

export const DESIGN_SYSTEM_KEY: InjectionKey<DesignSystemContext> = Symbol('design-system');

/**
 * Vue composable for accessing design system configuration
 *
 * Provides:
 * - Design tokens (colors, spacing, typography)
 * - Component styles
 * - Utility functions
 * - Theme configuration
 *
 * @returns Design system configuration and utilities
 *
 * @example
 * ```vue
 * <script setup lang="ts">
 * import { useDesignSystem } from '@/composables/useDesignSystem';
 *
 * const { tokens, components, isGlassmorphism } = useDesignSystem();
 * </script>
 *
 * <template>
 *   <button :class="components.button.base">
 *     Click me
 *   </button>
 * </template>
 * ```
 */
export function useDesignSystem() {
  const context = inject(DESIGN_SYSTEM_KEY);

  if (!context) {
    throw new Error('useDesignSystem must be used within a DesignSystemProvider');
  }

  const { config, tokens, components, setSystem } = context;

  /**
   * Get token value by path
   * @example getToken('colors.primary.500')
   */
  const getToken = (path: string): string | number | undefined => {
    return path.split('.').reduce((obj, key) => obj?.[key], tokens.value as any);
  };

  /**
   * Get component styles by name
   * @example getComponent('button')
   */
  const getComponent = (name: keyof ComponentStyles) => {
    return components.value[name];
  };

  /**
   * Check if current system matches
   */
  const isSystem = (systemName: string) => {
    return config.value.name === systemName;
  };

  /**
   * Get responsive value based on breakpoint
   */
  const getResponsive = <T,>(values: {
    mobile?: T;
    tablet?: T;
    desktop?: T;
    default: T;
  }): T => {
    if (typeof window === 'undefined') return values.default;

    const width = window.innerWidth;
    if (width >= 1024 && values.desktop) return values.desktop;
    if (width >= 768 && values.tablet) return values.tablet;
    if (width < 768 && values.mobile) return values.mobile;
    return values.default;
  };

  // Computed flags for each design system
  const isGlassmorphism = computed(() => isSystem('glassmorphism'));
  const isNeumorphism = computed(() => isSystem('neumorphism'));
  const isNeoBrutalism = computed(() => isSystem('neo-brutalism'));
  const isClaymorphism = computed(() => isSystem('claymorphism'));
  const isGeist = computed(() => isSystem('geist'));

  return {
    // Core config
    config,
    tokens,
    components,

    // Utilities
    getToken,
    getComponent,
    isSystem,
    getResponsive,
    setSystem,

    // Design system specific flags
    isGlassmorphism,
    isNeumorphism,
    isNeoBrutalism,
    isClaymorphism,
    isGeist,
  };
}

/**
 * Composable to access design tokens directly
 */
export function useTokens(): ComputedRef<DesignTokens> {
  const { tokens } = useDesignSystem();
  return tokens;
}

/**
 * Composable to access component styles directly
 */
export function useComponents(): ComputedRef<ComponentStyles> {
  const { components } = useDesignSystem();
  return components;
}
