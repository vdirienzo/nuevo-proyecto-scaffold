/**
 * BrutalGrid.tsx - Neo-Brutalism asymmetric grid component
 *
 * Autor: Homero Thompson del Lago del Terror
 * Project: {{PROJECT_NAME}}
 */

import React from 'react'
import { cn } from '@/lib/utils'

export interface BrutalGridProps extends React.HTMLAttributes<HTMLDivElement> {
  layout?: 'asymmetric' | 'masonry' | 'overlap' | 'chaos'
  columns?: 2 | 3 | 4
  gap?: 'sm' | 'md' | 'lg' | 'xl'
  children: React.ReactNode
}

const BrutalGrid = React.forwardRef<HTMLDivElement, BrutalGridProps>(
  (
    {
      className,
      layout = 'asymmetric',
      columns = 3,
      gap = 'md',
      children,
      ...props
    },
    ref
  ) => {
    const gapClasses = {
      sm: 'gap-4',
      md: 'gap-6',
      lg: 'gap-8',
      xl: 'gap-12',
    }

    const columnClasses = {
      2: 'grid-cols-2',
      3: 'grid-cols-3',
      4: 'grid-cols-4',
    }

    // Convert children to array for manipulation
    const childrenArray = React.Children.toArray(children)

    if (layout === 'asymmetric') {
      return (
        <div
          ref={ref}
          className={cn(
            'grid',
            columnClasses[columns],
            gapClasses[gap],
            className
          )}
          {...props}
        >
          {childrenArray.map((child, index) => (
            <div
              key={index}
              className={cn(
                // Random spans for asymmetry
                index % 5 === 0 && 'col-span-2 row-span-2',
                index % 7 === 0 && 'col-span-1 row-span-2',
                index % 11 === 0 && 'col-span-2 row-span-1'
              )}
              style={{
                // Slight rotation for chaos
                transform: `rotate(${(index % 3 - 1) * 2}deg)`,
              }}
            >
              {child}
            </div>
          ))}
        </div>
      )
    }

    if (layout === 'masonry') {
      return (
        <div
          ref={ref}
          className={cn(
            'columns-' + columns,
            gapClasses[gap],
            className
          )}
          {...props}
        >
          {childrenArray.map((child, index) => (
            <div
              key={index}
              className="break-inside-avoid mb-6"
            >
              {child}
            </div>
          ))}
        </div>
      )
    }

    if (layout === 'overlap') {
      return (
        <div
          ref={ref}
          className={cn(
            'relative',
            className
          )}
          style={{
            minHeight: '600px',
          }}
          {...props}
        >
          {childrenArray.map((child, index) => (
            <div
              key={index}
              className="absolute"
              style={{
                top: `${index * 60}px`,
                left: `${index * 40}px`,
                zIndex: childrenArray.length - index,
                transform: `rotate(${(index % 3 - 1) * 3}deg)`,
              }}
            >
              {child}
            </div>
          ))}
        </div>
      )
    }

    if (layout === 'chaos') {
      const rotations = [-6, -3, -1, 0, 1, 3, 6]
      const offsets = [0, 8, -8, 16, -16, 4, -4]

      return (
        <div
          ref={ref}
          className={cn(
            'grid',
            columnClasses[columns],
            gapClasses[gap],
            className
          )}
          {...props}
        >
          {childrenArray.map((child, index) => (
            <div
              key={index}
              style={{
                transform: `rotate(${rotations[index % rotations.length]}deg)`,
                marginTop: `${offsets[index % offsets.length]}px`,
              }}
            >
              {child}
            </div>
          ))}
        </div>
      )
    }

    // Default grid
    return (
      <div
        ref={ref}
        className={cn(
          'grid',
          columnClasses[columns],
          gapClasses[gap],
          className
        )}
        {...props}
      >
        {children}
      </div>
    )
  }
)

BrutalGrid.displayName = 'BrutalGrid'

export default BrutalGrid
