<!--
  ClayAvatar.vue - Claymorphism Avatar Component (Vue 3)

  Autor: {{AUTHOR}}
  Proyecto: {{PROJECT_NAME}}
-->

<script setup lang="ts">
import { ref, computed } from 'vue'

interface Props {
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl'
  online?: boolean
  variant?: 'pink' | 'blue' | 'green' | 'yellow' | 'purple'
  fallback?: string
  src?: string
  alt?: string
}

const props = withDefaults(defineProps<Props>(), {
  size: 'md',
  variant: 'blue',
  alt: 'Avatar',
})

const imageError = ref(false)

const showFallback = computed(() => !props.src || imageError.value)

const sizeClasses = computed(() => {
  const sizes = {
    xs: 'w-8 h-8',
    sm: 'w-12 h-12',
    md: 'w-16 h-16',
    lg: 'w-24 h-24',
    xl: 'w-32 h-32',
  }
  return sizes[props.size]
})

const statusSizeClasses = computed(() => {
  const sizes = {
    xs: 'w-2 h-2',
    sm: 'w-3 h-3',
    md: 'w-4 h-4',
    lg: 'w-5 h-5',
    xl: 'w-6 h-6',
  }
  return sizes[props.size]
})

const variantClasses = computed(() => {
  const variants = {
    pink: 'bg-clay-pink-400 text-white',
    blue: 'bg-clay-blue-400 text-white',
    green: 'bg-clay-green-400 text-white',
    yellow: 'bg-clay-yellow-400 text-gray-800',
    purple: 'bg-clay-purple-400 text-white',
  }
  return variants[props.variant]
})

const fallbackInitial = computed(() => {
  if (props.fallback) {
    return props.fallback.charAt(0).toUpperCase()
  }
  return '?'
})

const handleImageError = () => {
  imageError.value = true
}
</script>

<template>
  <div class="relative inline-block">
    <!-- Avatar circle -->
    <div
      :class="[
        sizeClasses,
        'rounded-full overflow-hidden shadow-clay',
        'transition-all duration-300',
        'hover:shadow-clay-hover hover:scale-105',
        showFallback ? variantClasses : 'bg-gray-200',
      ]"
    >
      <!-- Fallback - initials or icon -->
      <div
        v-if="showFallback"
        class="w-full h-full flex items-center justify-center font-bold text-xl"
      >
        {{ fallbackInitial }}
      </div>

      <!-- Image -->
      <img
        v-else
        :src="src"
        :alt="alt"
        class="w-full h-full object-cover"
        @error="handleImageError"
      />
    </div>

    <!-- Online status indicator -->
    <div
      v-if="online !== undefined"
      :class="[
        'absolute bottom-0 right-0',
        statusSizeClasses,
        'rounded-full',
        'border-2 border-white',
        'shadow-clay-sm',
        online ? 'bg-clay-green-500 animate-pulse' : 'bg-gray-400',
      ]"
    />
  </div>
</template>
