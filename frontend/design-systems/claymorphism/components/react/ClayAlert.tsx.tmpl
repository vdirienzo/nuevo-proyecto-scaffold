/**
 * ClayAlert.tsx - Claymorphism Alert/Toast Component
 *
 * Autor: {{AUTHOR}}
 * Proyecto: {{PROJECT_NAME}}
 */

import React, { HTMLAttributes, ReactNode, useEffect, useState } from 'react'

export interface ClayAlertProps extends HTMLAttributes<HTMLDivElement> {
  variant?: 'success' | 'warning' | 'error' | 'info'
  title?: string
  children: ReactNode
  dismissible?: boolean
  onDismiss?: () => void
  icon?: ReactNode
  autoClose?: boolean
  autoCloseDelay?: number
}

const variantConfig = {
  success: {
    bg: 'bg-clay-green-100',
    border: 'border-clay-green-400',
    icon: '✓',
    iconBg: 'bg-clay-green-400',
  },
  warning: {
    bg: 'bg-clay-yellow-100',
    border: 'border-clay-yellow-400',
    icon: '⚠',
    iconBg: 'bg-clay-yellow-400',
  },
  error: {
    bg: 'bg-clay-pink-100',
    border: 'border-clay-pink-400',
    icon: '✕',
    iconBg: 'bg-clay-pink-400',
  },
  info: {
    bg: 'bg-clay-blue-100',
    border: 'border-clay-blue-400',
    icon: 'ℹ',
    iconBg: 'bg-clay-blue-400',
  },
}

export const ClayAlert: React.FC<ClayAlertProps> = ({
  variant = 'info',
  title,
  children,
  dismissible = false,
  onDismiss,
  icon,
  autoClose = false,
  autoCloseDelay = 5000,
  className = '',
  ...props
}) => {
  const [isVisible, setIsVisible] = useState(true)
  const config = variantConfig[variant]

  useEffect(() => {
    if (autoClose) {
      const timer = setTimeout(() => {
        setIsVisible(false)
        onDismiss?.()
      }, autoCloseDelay)

      return () => clearTimeout(timer)
    }
  }, [autoClose, autoCloseDelay, onDismiss])

  if (!isVisible) return null

  const handleDismiss = () => {
    setIsVisible(false)
    onDismiss?.()
  }

  return (
    <div
      className={`
        relative
        rounded-clay
        shadow-clay
        border-2
        p-4
        animate-bounce-soft
        ${config.bg}
        ${config.border}
        ${className}
      `}
      role="alert"
      {...props}
    >
      <div className="flex items-start gap-4">
        {/* Icon */}
        <div
          className={`
            flex-shrink-0
            w-10 h-10
            rounded-full
            shadow-clay-sm
            flex items-center justify-center
            text-white text-xl font-bold
            ${config.iconBg}
          `}
        >
          {icon || config.icon}
        </div>

        {/* Content */}
        <div className="flex-1 min-w-0">
          {title && (
            <h4 className="font-bold text-gray-800 mb-1">
              {title}
            </h4>
          )}
          <div className="text-gray-700 text-sm">
            {children}
          </div>
        </div>

        {/* Dismiss button */}
        {dismissible && (
          <button
            onClick={handleDismiss}
            className="
              flex-shrink-0
              w-6 h-6
              rounded-full
              flex items-center justify-center
              text-gray-500
              hover:bg-gray-200/50
              transition-all duration-200
              hover:scale-110 hover:rotate-90
              focus:outline-none
            "
            aria-label="Dismiss"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              className="h-4 w-4"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fillRule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clipRule="evenodd"
              />
            </svg>
          </button>
        )}
      </div>

      {/* Progress bar for auto-close */}
      {autoClose && (
        <div className="absolute bottom-0 left-0 right-0 h-1 bg-gray-200/50 rounded-b-clay overflow-hidden">
          <div
            className={`h-full ${config.iconBg} transition-all`}
            style={{
              animation: `shrink ${autoCloseDelay}ms linear`,
            }}
          />
        </div>
      )}

      <style jsx>{`
        @keyframes shrink {
          from { width: 100%; }
          to { width: 0%; }
        }
      `}</style>
    </div>
  )
}

export default ClayAlert
