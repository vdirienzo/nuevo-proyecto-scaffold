/**
 * ClayAvatar.tsx - Claymorphism Avatar Component
 *
 * Autor: {{AUTHOR}}
 * Proyecto: {{PROJECT_NAME}}
 */

import React, { ImgHTMLAttributes } from 'react'

export interface ClayAvatarProps extends Omit<ImgHTMLAttributes<HTMLImageElement>, 'size'> {
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl'
  online?: boolean
  variant?: 'pink' | 'blue' | 'green' | 'yellow' | 'purple'
  fallback?: string
}

const sizeStyles = {
  xs: 'w-8 h-8',
  sm: 'w-12 h-12',
  md: 'w-16 h-16',
  lg: 'w-24 h-24',
  xl: 'w-32 h-32',
}

const statusSizes = {
  xs: 'w-2 h-2',
  sm: 'w-3 h-3',
  md: 'w-4 h-4',
  lg: 'w-5 h-5',
  xl: 'w-6 h-6',
}

const variantStyles = {
  pink: 'bg-clay-pink-400 text-white',
  blue: 'bg-clay-blue-400 text-white',
  green: 'bg-clay-green-400 text-white',
  yellow: 'bg-clay-yellow-400 text-gray-800',
  purple: 'bg-clay-purple-400 text-white',
}

export const ClayAvatar: React.FC<ClayAvatarProps> = ({
  size = 'md',
  online,
  variant = 'blue',
  fallback,
  src,
  alt = 'Avatar',
  className = '',
  ...props
}) => {
  const [imageError, setImageError] = React.useState(false)

  const showFallback = !src || imageError

  return (
    <div className={`relative inline-block ${className}`}>
      {/* Avatar circle */}
      <div
        className={`
          ${sizeStyles[size]}
          rounded-full
          overflow-hidden
          shadow-clay
          transition-all duration-300
          hover:shadow-clay-hover hover:scale-105
          ${showFallback ? variantStyles[variant] : 'bg-gray-200'}
        `}
      >
        {showFallback ? (
          /* Fallback - initials or icon */
          <div className="w-full h-full flex items-center justify-center font-bold text-xl">
            {fallback ? fallback.charAt(0).toUpperCase() : '?'}
          </div>
        ) : (
          /* Image */
          <img
            src={src}
            alt={alt}
            className="w-full h-full object-cover"
            onError={() => setImageError(true)}
            {...props}
          />
        )}
      </div>

      {/* Online status indicator */}
      {online !== undefined && (
        <div
          className={`
            absolute bottom-0 right-0
            ${statusSizes[size]}
            rounded-full
            border-2 border-white
            shadow-clay-sm
            ${online ? 'bg-clay-green-500 animate-pulse' : 'bg-gray-400'}
          `}
        />
      )}
    </div>
  )
}

export interface ClayAvatarGroupProps {
  children: React.ReactNode
  max?: number
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl'
  className?: string
}

export const ClayAvatarGroup: React.FC<ClayAvatarGroupProps> = ({
  children,
  max = 3,
  size = 'md',
  className = '',
}) => {
  const childrenArray = React.Children.toArray(children)
  const displayedChildren = max ? childrenArray.slice(0, max) : childrenArray
  const remainingCount = childrenArray.length - displayedChildren.length

  const overlapStyles = {
    xs: '-ml-2',
    sm: '-ml-3',
    md: '-ml-4',
    lg: '-ml-6',
    xl: '-ml-8',
  }

  return (
    <div className={`flex items-center ${className}`}>
      {displayedChildren.map((child, index) => (
        <div
          key={index}
          className={`
            relative
            ${index > 0 ? overlapStyles[size] : ''}
            transition-transform duration-200
            hover:z-10 hover:scale-110
          `}
          style={{ zIndex: displayedChildren.length - index }}
        >
          {React.cloneElement(child as React.ReactElement, { size })}
        </div>
      ))}

      {/* Remaining count indicator */}
      {remainingCount > 0 && (
        <div
          className={`
            ${sizeStyles[size]}
            ${overlapStyles[size]}
            rounded-full
            bg-clay-purple-400
            text-white
            shadow-clay
            flex items-center justify-center
            font-bold text-sm
            hover:scale-110 transition-transform duration-200
          `}
          style={{ zIndex: 0 }}
        >
          +{remainingCount}
        </div>
      )}
    </div>
  )
}

export default ClayAvatar
