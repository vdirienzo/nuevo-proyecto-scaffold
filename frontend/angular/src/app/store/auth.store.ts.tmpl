/**
 * auth.store.ts - Authentication state management with NgRx Signals
 * @author {{AUTHOR}}
 * @project {{PROJECT_NAME}}
 */

import { computed } from '@angular/core';
import { patchState, signalStore, withComputed, withMethods, withState } from '@ngrx/signals';
import { User } from '@core/services/auth.service';

interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  loading: boolean;
  error: string | null;
}

const initialState: AuthState = {
  user: null,
  token: null,
  isAuthenticated: false,
  loading: false,
  error: null
};

export const AuthStore = signalStore(
  { providedIn: 'root' },
  withState(initialState),
  withComputed((store) => ({
    userName: computed(() => store.user()?.username ?? 'Guest'),
    userEmail: computed(() => store.user()?.email ?? ''),
    isLoggedIn: computed(() => store.isAuthenticated() && !!store.user())
  })),
  withMethods((store) => ({
    setUser(user: User): void {
      patchState(store, { user, isAuthenticated: true, error: null });
    },
    setToken(token: string): void {
      patchState(store, { token });
    },
    setLoading(loading: boolean): void {
      patchState(store, { loading });
    },
    setError(error: string): void {
      patchState(store, { error, loading: false });
    },
    clearError(): void {
      patchState(store, { error: null });
    },
    logout(): void {
      patchState(store, initialState);
    },
    reset(): void {
      patchState(store, initialState);
    }
  }))
);
