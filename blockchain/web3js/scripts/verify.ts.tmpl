import { run } from "hardhat";
import * as fs from "fs";
import * as path from "path";

/**
 * Verification script for {{PROJECT_NAME}} contracts
 * @author {{AUTHOR}}
 */

async function main() {
  const network = process.env.HARDHAT_NETWORK || "localhost";

  console.log(`Verifying contracts on ${network}...`);

  // Load deployment info
  const deploymentPath = path.join(
    __dirname,
    "..",
    "deployments",
    `deployment-${network}-latest.json`
  );

  if (!fs.existsSync(deploymentPath)) {
    console.error(`No deployment file found for network: ${network}`);
    console.error(`Expected file: ${deploymentPath}`);
    process.exit(1);
  }

  const deployment = JSON.parse(fs.readFileSync(deploymentPath, "utf-8"));

  console.log("\n--- Verifying Token ---");
  try {
    await run("verify:verify", {
      address: deployment.contracts.Token.address,
      constructorArguments: deployment.contracts.Token.constructorArgs,
    });
    console.log("Token verified successfully!");
  } catch (error: any) {
    if (error.message.includes("Already Verified")) {
      console.log("Token already verified");
    } else {
      console.error("Token verification failed:", error.message);
    }
  }

  console.log("\n--- Verifying NFT ---");
  try {
    await run("verify:verify", {
      address: deployment.contracts.NFT.address,
      constructorArguments: deployment.contracts.NFT.constructorArgs,
    });
    console.log("NFT verified successfully!");
  } catch (error: any) {
    if (error.message.includes("Already Verified")) {
      console.log("NFT already verified");
    } else {
      console.error("NFT verification failed:", error.message);
    }
  }

  console.log("\n--- Verifying Marketplace ---");
  try {
    await run("verify:verify", {
      address: deployment.contracts.Marketplace.address,
      constructorArguments: deployment.contracts.Marketplace.constructorArgs,
    });
    console.log("Marketplace verified successfully!");
  } catch (error: any) {
    if (error.message.includes("Already Verified")) {
      console.log("Marketplace already verified");
    } else {
      console.error("Marketplace verification failed:", error.message);
    }
  }

  console.log("\n--- Verification Complete ---");
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
