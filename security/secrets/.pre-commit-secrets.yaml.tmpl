# .pre-commit-secrets.yaml - Pre-commit hooks for secrets
# Author: {{AUTHOR}}
# Project: {{PROJECT_NAME}}

repos:
  - repo: https://github.com/trufflesecurity/trufflehog
    rev: v3.63.0
    hooks:
      - id: trufflehog
        name: TruffleHog
        entry: trufflehog git file://. --since-commit HEAD --only-verified --fail
        language: system
        stages: [commit, push]

  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.18.0
    hooks:
      - id: gitleaks
        name: Gitleaks
        entry: gitleaks protect --verbose --redact --staged
        language: system
        stages: [commit]

  - repo: local
    hooks:
      - id: detect-secrets
        name: Detect Secrets
        entry: detect-secrets-hook
        language: python
        args: ['--baseline', '.secrets.baseline']
        stages: [commit]

      - id: no-env-files
        name: No .env files
        entry: bash -c 'git diff --cached --name-only | grep -E "^\.env(\..+)?$" && exit 1 || exit 0'
        language: system
        stages: [commit]

      - id: no-private-keys
        name: No private keys
        entry: bash -c 'git diff --cached --name-only | grep -E "\.(pem|key|p12|pfx)$" && exit 1 || exit 0'
        language: system
        stages: [commit]
