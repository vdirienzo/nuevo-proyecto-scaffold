-- init-db.sql - Database Initialization Script
-- Author: {{AUTHOR}}
-- Project: {{PROJECT_NAME}}
--
-- This script runs when PostgreSQL container starts for the first time.

-- Enable required extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- Create application user with limited privileges (security best practice)
DO $$
BEGIN
    IF NOT EXISTS (SELECT FROM pg_catalog.pg_roles WHERE rolname = 'app_user') THEN
        CREATE ROLE app_user WITH LOGIN PASSWORD 'app_password';
    END IF;
END
$$;

-- Grant privileges
GRANT CONNECT ON DATABASE {{PROJECT_NAME_SNAKE}} TO app_user;
GRANT USAGE ON SCHEMA public TO app_user;

-- Default privileges for future tables
ALTER DEFAULT PRIVILEGES IN SCHEMA public
    GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO app_user;

ALTER DEFAULT PRIVILEGES IN SCHEMA public
    GRANT USAGE, SELECT ON SEQUENCES TO app_user;

-- Log initialization
DO $$
BEGIN
    RAISE NOTICE 'Database {{PROJECT_NAME_SNAKE}} initialized successfully';
END
$$;
