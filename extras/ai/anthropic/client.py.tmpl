"""
Anthropic Client - Python

Author: {{AUTHOR}}
Project: {{PROJECT_NAME}}
"""

import os
from typing import AsyncGenerator

from anthropic import AsyncAnthropic

client = AsyncAnthropic(api_key=os.getenv("ANTHROPIC_API_KEY"))


async def create_message(
    messages: list[dict[str, str]],
    model: str = "claude-3-5-sonnet-20241022",
    max_tokens: int = 4096,
    temperature: float = 1.0,
    system: str | None = None,
) -> str:
    """Generate message completion."""
    response = await client.messages.create(
        model=model,
        max_tokens=max_tokens,
        temperature=temperature,
        system=system,
        messages=messages,
    )

    return response.content[0].text


async def stream_message(
    messages: list[dict[str, str]],
    model: str = "claude-3-5-sonnet-20241022",
    max_tokens: int = 4096,
    temperature: float = 1.0,
    system: str | None = None,
) -> AsyncGenerator[str, None]:
    """Stream message completion."""
    async with client.messages.stream(
        model=model,
        max_tokens=max_tokens,
        temperature=temperature,
        system=system,
        messages=messages,
    ) as stream:
        async for text in stream.text_stream:
            yield text


async def count_tokens(
    messages: list[dict[str, str]],
    system: str | None = None,
) -> int:
    """Count tokens."""
    response = await client.messages.count_tokens(
        model="claude-3-5-sonnet-20241022",
        messages=messages,
        system=system,
    )

    return response.input_tokens
