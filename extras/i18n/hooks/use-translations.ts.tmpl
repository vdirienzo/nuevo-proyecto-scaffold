/**
 * Translation Hooks
 *
 * Author: {{AUTHOR}}
 * Project: {{PROJECT_NAME}}
 */

'use client';

import { useTranslations as useNextIntlTranslations } from 'next-intl';
import { useLocale } from 'next-intl';
import { useRouter, usePathname } from 'next/navigation';
import { Locale, addLocaleToPathname, removeLocaleFromPathname } from '../next-intl/config';

/**
 * Hook for translations (re-export from next-intl)
 */
export function useTranslations(namespace?: string) {
  return useNextIntlTranslations(namespace);
}

/**
 * Hook for current locale
 */
export function useCurrentLocale() {
  return useLocale() as Locale;
}

/**
 * Hook for locale switching
 */
export function useLocaleSwitcher() {
  const router = useRouter();
  const pathname = usePathname();
  const currentLocale = useCurrentLocale();

  const switchLocale = (newLocale: Locale) => {
    // Remove current locale from pathname
    const pathnameWithoutLocale = removeLocaleFromPathname(pathname);

    // Add new locale
    const newPathname = addLocaleToPathname(pathnameWithoutLocale, newLocale);

    // Navigate to new path
    router.push(newPathname);
  };

  return {
    currentLocale,
    switchLocale,
  };
}

/**
 * Hook for formatted date
 */
export function useFormattedDate() {
  const locale = useCurrentLocale();

  const format = (
    date: Date | string,
    options?: Intl.DateTimeFormatOptions
  ): string => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;

    return new Intl.DateTimeFormat(locale, {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      ...options,
    }).format(dateObj);
  };

  const formatRelative = (date: Date | string): string => {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    const now = new Date();
    const diffMs = now.getTime() - dateObj.getTime();
    const diffSec = Math.floor(diffMs / 1000);
    const diffMin = Math.floor(diffSec / 60);
    const diffHour = Math.floor(diffMin / 60);
    const diffDay = Math.floor(diffHour / 24);

    const rtf = new Intl.RelativeTimeFormat(locale, { numeric: 'auto' });

    if (diffDay > 0) return rtf.format(-diffDay, 'day');
    if (diffHour > 0) return rtf.format(-diffHour, 'hour');
    if (diffMin > 0) return rtf.format(-diffMin, 'minute');
    return rtf.format(-diffSec, 'second');
  };

  return { format, formatRelative };
}

/**
 * Hook for formatted numbers
 */
export function useFormattedNumber() {
  const locale = useCurrentLocale();

  const format = (
    value: number,
    options?: Intl.NumberFormatOptions
  ): string => {
    return new Intl.NumberFormat(locale, options).format(value);
  };

  const formatCurrency = (
    value: number,
    currency: string = 'USD'
  ): string => {
    return new Intl.NumberFormat(locale, {
      style: 'currency',
      currency,
    }).format(value);
  };

  const formatPercent = (value: number): string => {
    return new Intl.NumberFormat(locale, {
      style: 'percent',
      minimumFractionDigits: 0,
      maximumFractionDigits: 2,
    }).format(value);
  };

  return { format, formatCurrency, formatPercent };
}

/**
 * Component for locale switcher
 */
export function LocaleSwitcher({
  className,
}: {
  className?: string;
}) {
  const { currentLocale, switchLocale } = useLocaleSwitcher();
  const t = useTranslations('Common');

  return (
    <select
      value={currentLocale}
      onChange={(e) => switchLocale(e.target.value as Locale)}
      className={className}
      aria-label={t('language')}
    >
      <option value="en">English</option>
      <option value="es">Español</option>
      <option value="fr">Français</option>
      <option value="de">Deutsch</option>
    </select>
  );
}
