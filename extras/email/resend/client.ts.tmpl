/**
 * Resend Email Client
 *
 * Author: {{AUTHOR}}
 * Project: {{PROJECT_NAME}}
 */

import { Resend } from 'resend';

const resend = new Resend(process.env.RESEND_API_KEY);

const FROM_EMAIL = process.env.FROM_EMAIL || 'noreply@{{PROJECT_NAME}}.com';
const FROM_NAME = '{{PROJECT_NAME}}';

/**
 * Send email with HTML content
 */
export async function sendEmail(
  to: string | string[],
  subject: string,
  html: string,
  options?: {
    from?: string;
    replyTo?: string;
    cc?: string[];
    bcc?: string[];
    attachments?: Array<{
      filename: string;
      content: Buffer | string;
    }>;
  }
) {
  const from = options?.from || `${FROM_NAME} <${FROM_EMAIL}>`;

  return resend.emails.send({
    from,
    to: Array.isArray(to) ? to : [to],
    subject,
    html,
    reply_to: options?.replyTo,
    cc: options?.cc,
    bcc: options?.bcc,
    attachments: options?.attachments,
  });
}

/**
 * Send email with React component
 */
export async function sendReactEmail(
  to: string | string[],
  subject: string,
  react: React.ReactElement,
  options?: {
    from?: string;
    replyTo?: string;
  }
) {
  const from = options?.from || `${FROM_NAME} <${FROM_EMAIL}>`;

  return resend.emails.send({
    from,
    to: Array.isArray(to) ? to : [to],
    subject,
    react,
    reply_to: options?.replyTo,
  });
}

/**
 * Send batch emails
 */
export async function sendBatchEmails(
  emails: Array<{
    to: string;
    subject: string;
    html: string;
  }>
) {
  return resend.batch.send(
    emails.map((email) => ({
      from: `${FROM_NAME} <${FROM_EMAIL}>`,
      to: email.to,
      subject: email.subject,
      html: email.html,
    }))
  );
}

/**
 * Get email by ID
 */
export async function getEmail(emailId: string) {
  return resend.emails.get(emailId);
}

/**
 * Cancel scheduled email
 */
export async function cancelEmail(emailId: string) {
  return resend.emails.cancel(emailId);
}

export { resend };
