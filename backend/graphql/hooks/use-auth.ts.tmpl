/**
 * use-auth.ts - Authentication GraphQL Hooks
 *
 * Author: {{AUTHOR}}
 * Project: {{PROJECT_NAME}}
 *
 * Generated by GraphQL Code Generator
 * This is an example of the generated hooks
 */

import { useMutation } from '@apollo/client';
import { gql } from '@apollo/client';

// Example mutation hooks (will be generated by codegen)
const REGISTER_MUTATION = gql`
  mutation Register($input: CreateUserInput!) {
    register(input: $input) {
      accessToken
      refreshToken
      user {
        id
        email
        name
        createdAt
        updatedAt
      }
    }
  }
`;

const LOGIN_MUTATION = gql`
  mutation Login($input: LoginInput!) {
    login(input: $input) {
      accessToken
      refreshToken
      user {
        id
        email
        name
        createdAt
        updatedAt
      }
    }
  }
`;

const LOGOUT_MUTATION = gql`
  mutation Logout {
    logout
  }
`;

/**
 * Hook to register new user
 */
export function useRegister() {
  const [register, { data, loading, error }] = useMutation(REGISTER_MUTATION);

  const registerUser = async (input: {
    email: string;
    password: string;
    name: string;
  }) => {
    const result = await register({ variables: { input } });

    if (result.data?.register) {
      const { accessToken, refreshToken } = result.data.register;
      localStorage.setItem('accessToken', accessToken);
      localStorage.setItem('refreshToken', refreshToken);
    }

    return result;
  };

  return { register: registerUser, data, loading, error };
}

/**
 * Hook to login user
 */
export function useLogin() {
  const [login, { data, loading, error }] = useMutation(LOGIN_MUTATION);

  const loginUser = async (input: { email: string; password: string }) => {
    const result = await login({ variables: { input } });

    if (result.data?.login) {
      const { accessToken, refreshToken } = result.data.login;
      localStorage.setItem('accessToken', accessToken);
      localStorage.setItem('refreshToken', refreshToken);
    }

    return result;
  };

  return { login: loginUser, data, loading, error };
}

/**
 * Hook to logout user
 */
export function useLogout() {
  const [logout, { data, loading, error }] = useMutation(LOGOUT_MUTATION);

  const logoutUser = async () => {
    const result = await logout();

    localStorage.removeItem('accessToken');
    localStorage.removeItem('refreshToken');

    return result;
  };

  return { logout: logoutUser, data, loading, error };
}
