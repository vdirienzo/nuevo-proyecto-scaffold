# Docker Compose - Dragonfly (Redis Alternative)
#
# Author: {{AUTHOR}}
# Project: {{PROJECT_NAME}}
#
# Dragonfly is a modern Redis replacement with:
# - 25x faster than Redis
# - Lower memory footprint
# - Full Redis API compatibility
# - Built-in vertical scaling
#
# Usage:
#   docker compose -f docker-compose.dragonfly.yml up -d

version: '3.8'

services:
  dragonfly:
    image: docker.dragonflydb.io/dragonflydb/dragonfly:latest
    container_name: {{PROJECT_NAME}}-dragonfly
    restart: unless-stopped
    ports:
      - "6379:6379"
    command:
      - --port=6379
      - --maxmemory=512mb
      - --keys_output_limit=12288
      - --dbnum=16
      - --requirepass=${REDIS_PASSWORD:-}
      # Performance tuning
      - --proactor_threads=2
      - --hz=1000
      # Persistence
      - --snapshot_cron=0 */1 * * *  # Snapshot every hour
      - --dir=/data
    volumes:
      - dragonfly_data:/data
    ulimits:
      memlock: -1
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    networks:
      - {{PROJECT_NAME}}_network

  redis-commander:
    image: rediscommander/redis-commander:latest
    container_name: {{PROJECT_NAME}}-redis-commander
    restart: unless-stopped
    ports:
      - "8081:8081"
    environment:
      - REDIS_HOSTS=dragonfly:dragonfly:6379:0:${REDIS_PASSWORD:-}
    depends_on:
      dragonfly:
        condition: service_healthy
    networks:
      - {{PROJECT_NAME}}_network

  # Optional: Redis Insight (works with Dragonfly)
  redis-insight:
    image: redislabs/redisinsight:latest
    container_name: {{PROJECT_NAME}}-redis-insight
    restart: unless-stopped
    ports:
      - "8001:8001"
    volumes:
      - redis_insight_data:/db
    depends_on:
      dragonfly:
        condition: service_healthy
    networks:
      - {{PROJECT_NAME}}_network

volumes:
  dragonfly_data:
    driver: local
  redis_insight_data:
    driver: local

networks:
  {{PROJECT_NAME}}_network:
    driver: bridge
