<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{PROJECT_NAME}} - Vanilla JS WASM Integration</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }

    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .section h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 18px;
    }

    input, button {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }

    input {
      width: 100%;
      margin-bottom: 10px;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
      transition: background 0.2s;
    }

    button:hover {
      background: #5568d3;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .result {
      margin-top: 10px;
      padding: 15px;
      background: white;
      border-left: 4px solid #667eea;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      word-break: break-all;
      display: none;
    }

    .result.show {
      display: block;
    }

    .result.error {
      border-left-color: #e74c3c;
      color: #e74c3c;
    }

    .result.success {
      border-left-color: #2ecc71;
      color: #2ecc71;
    }

    .performance {
      font-size: 12px;
      color: #999;
      margin-top: 5px;
    }

    .status {
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .status.loading {
      background: #fff3cd;
      color: #856404;
    }

    .status.ready {
      background: #d4edda;
      color: #155724;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>{{PROJECT_NAME}}</h1>
    <p class="subtitle">Vanilla JavaScript + WebAssembly Integration</p>

    <div id="status" class="status loading">Loading WASM module...</div>

    <div class="section">
      <h2>Hash Calculator</h2>
      <input type="text" id="hashInput" placeholder="Enter text to hash">
      <button onclick="calculateHash()" disabled>Calculate SHA-256</button>
      <div id="hashResult" class="result"></div>
    </div>

    <div class="section">
      <h2>Email Validator</h2>
      <input type="email" id="emailInput" placeholder="Enter email address">
      <button onclick="validateEmail()" disabled>Validate Email</button>
      <div id="emailResult" class="result"></div>
    </div>

    <div class="section">
      <h2>Performance Benchmark</h2>
      <button onclick="runBenchmark()" disabled>Run Benchmark</button>
      <div id="benchmarkResult" class="result"></div>
    </div>
  </div>

  <script type="module">
    import { WasmLoader, WasmHelpers } from './wasm-loader.js';

    // Initialize loader
    const loader = new WasmLoader();
    let wasm = null;

    // Load WASM module
    async function init() {
      const statusEl = document.getElementById('status');

      try {
        // Adjust path to your WASM module
        wasm = await loader.loadModule('../../rust-wasm/pkg/{{PROJECT_NAME}}_wasm.js');

        statusEl.className = 'status ready';
        statusEl.textContent = '✅ WASM module ready';

        // Enable all buttons
        document.querySelectorAll('button').forEach(btn => {
          btn.disabled = false;
        });

      } catch (error) {
        statusEl.className = 'status error';
        statusEl.textContent = `❌ Error loading WASM: ${error.message}`;
        console.error(error);
      }
    }

    // Calculate hash
    window.calculateHash = function() {
      const input = document.getElementById('hashInput').value;
      const resultEl = document.getElementById('hashResult');

      if (!input) {
        showResult(resultEl, 'Please enter some text', 'error');
        return;
      }

      try {
        const start = performance.now();
        const data = WasmHelpers.stringToBytes(input);
        const hash = wasm.sha256_hex(data);
        const duration = performance.now() - start;

        showResult(
          resultEl,
          `SHA-256: ${hash}<div class="performance">⚡ ${duration.toFixed(2)}ms</div>`,
          'success'
        );
      } catch (error) {
        showResult(resultEl, `Error: ${error.message}`, 'error');
      }
    };

    // Validate email
    window.validateEmail = function() {
      const input = document.getElementById('emailInput').value;
      const resultEl = document.getElementById('emailResult');

      if (!input) {
        showResult(resultEl, 'Please enter an email', 'error');
        return;
      }

      try {
        const isValid = wasm.validate_email(input);
        showResult(
          resultEl,
          isValid ? '✅ Valid email' : '❌ Invalid email',
          isValid ? 'success' : 'error'
        );
      } catch (error) {
        showResult(resultEl, `Error: ${error.message}`, 'error');
      }
    };

    // Run benchmark
    window.runBenchmark = function() {
      const resultEl = document.getElementById('benchmarkResult');
      const iterations = 10000;

      try {
        const testData = WasmHelpers.stringToBytes('benchmark test data');

        // Benchmark hash function
        const hashResult = WasmHelpers.measure(() => {
          wasm.sha256_hex(testData);
        }, iterations);

        // Benchmark email validation
        const emailResult = WasmHelpers.measure(() => {
          wasm.validate_email('test@example.com');
        }, iterations);

        const html = `
          <strong>Performance Results</strong> (${iterations.toLocaleString()} iterations)<br><br>

          <strong>SHA-256 Hashing:</strong><br>
          Total: ${hashResult.duration.toFixed(2)}ms |
          Average: ${hashResult.average.toFixed(4)}ms |
          Ops/sec: ${Math.floor(hashResult.opsPerSec).toLocaleString()}<br><br>

          <strong>Email Validation:</strong><br>
          Total: ${emailResult.duration.toFixed(2)}ms |
          Average: ${emailResult.average.toFixed(4)}ms |
          Ops/sec: ${Math.floor(emailResult.opsPerSec).toLocaleString()}
        `;

        showResult(resultEl, html, 'success');
      } catch (error) {
        showResult(resultEl, `Error: ${error.message}`, 'error');
      }
    };

    // Helper to show results
    function showResult(element, html, type) {
      element.innerHTML = html;
      element.className = `result show ${type}`;
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
